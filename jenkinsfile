properties([parameters([choice(choices: ['Patch','Minor','Major'], description: 'Third stage meassage', name: 'Patch' )])])
pipeline{
  agent any
   environment {
    DOCKERHUB_CREDENTIALS=credentials('dockerhub')
  }
  stages{
        stage('Build'){
            steps{
              script{
                     if("${Patch}"=="Patch")
                     {
		   def flage = readFile('patch')
                    echo "${flage}"
                    def version = "1.0.${flage}"
                     echo "${version}"
                     sh "docker build -t nadeem90/test-image:${version}"

                     flage=flage+1      
                     
                    echo "${flage}"
                    
                     }else{
                      echo "version is not patch"
                     }  
                }    
  
           }
        }
    
   stage('Trigger ManifestUpdate') {
		steps{
                echo "triggering updatemanifestjob"
                build job: 'updatepatch-file', parameters: [string(name: 'DOCKERTAG', value: env.flage)]
			}
        }
    
    
    
     }  
}
