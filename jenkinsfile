pipeline{

	agent any

	environment {
		DOCKERHUB_CREDENTIALS=credentials('dockerhub')
	}

	stages {
	    
//	     stage('gitclone') {

//		 	steps {
//				git branch: 'main', credentialsId: 'github', url: 'https://github.com/NadeemRais/node-app-test.git'
//		 	}
//		 }

		//stage('Build for frontend image') {

			//steps {
				//sh "docker build -t nadeem90/frontend:1.0.${env.BUILD_ID} FrontEnd/."
				//}
			//}
		//}

		stage('Build') {
            steps {
                script {
                    def version = readFile('VERSION')
                    def versions = version.split('\\.')
                    def major = versions[0]
                    def minor = versions[0] + '.' + versions[1]
                    def patch = version.trim()

                    docker.withRegistry('', 'dockerhub') {
                        def image = docker.build('nadeem90/blog-docker-versioning:latest')
                        image.push()
                        image.push(major)
                        image.push(minor)
                        image.push(patch)
                    }
                }
            }
        }

      

//		stage('Login') {
//
//			steps {
//				sh 'echo $DOCKERHUB_CREDENTIALS_PSW | docker login -u $DOCKERHUB_CREDENTIALS_USR --password-stdin'
//			}
//		}

		//stage('Push') {

			//steps {
				       // sh 'docker push nadeem90/frontend:1.0.${env.BUILD_ID}'
              
		//	}
	//	}
		
	}
}	
